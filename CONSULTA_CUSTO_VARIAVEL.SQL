
select  CAST(SUBSTRING( B9_DATA , 5, 2) as INTEGER) as MES, SUBSTRING( B9_DATA , 1, 4) AS ANO ,SM0.FILFULL AS COD_FIL,SM0.FILIAL AS DESC_FIL, 
CAST(AY0.AY0_CODIGO as FLOAT) AS COD_CAT, 
 AY0.AY0_DESC AS DESC_CAT 
, AVG(B9_CM1) AS VALOR

FROM SM0010 SM0
INNER JOIN SB9010 SB9 ON B9_FILIAL = SM0.FILFULL

INNER JOIN SB1010 SB1 ON B1_COD = B9_COD

INNER JOIN AY0010 AY0 ON SB1.B1_01CAT5 =AY0.AY0_CODIGO 

	WHERE  SB9.D_E_L_E_T_ = ' ' AND SB1.D_E_L_E_T_ = ' ' AND AY0.D_E_L_E_T_ = ' '
	AND B9_LOCAL='01'
	AND AY0.AY0_TIPO ='5'
	AND B9_DATA >=  ${DATA_INICIAL} 
	AND B9_DATA <=  ${DATA_FINAL} 
	--AND SB9.B9_DATA > '20220728' AND SB9.B9_DATA < '20220831'
	
group by SUBSTRING( B9_DATA , 5, 2), SUBSTRING( B9_DATA , 1, 4) , SM0.FILFULL ,SM0.FILIAL,AY0_CODIGO,AY0_DESC
ORDER BY SUBSTRING( B9_DATA , 5, 2), SUBSTRING( B9_DATA , 1, 4) , SM0.FILFULL ,SM0.FILIAL,AY0_CODIGO

;