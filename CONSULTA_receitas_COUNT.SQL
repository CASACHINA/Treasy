
SELECT COUNT(*) FROM (
	select  1 as cnt
	FROM SM0010 SM0
	INNER JOIN SD2010 SD2 ON D2_FILIAL = SM0.FILFULL
	INNER JOIN SB1010 SB1 ON B1_COD = D2_COD

	INNER JOIN AY0010 AY0 ON SB1.B1_01CAT5 =AY0.AY0_CODIGO 
	INNER JOIN SF4010 SF4 ON D2_TES = F4_CODIGO AND F4_CODIGO IN( '502',
	'503',
	'504',
	'507',
	'508',
	'519',
	'602',
	'603',
	'605',
	'606',
	'607',
	'608',
	'610',
	'611',
	'683',
	'684',
	'685',
	'687',
	'688',
	'691',
	'700')
		WHERE  SB1.D_E_L_E_T_ = ' ' AND SD2.D_E_L_E_T_ = ' '
			
		AND D2_EMISSAO >=  ${DATA_INICIAL} 
		AND D2_EMISSAO <=  ${DATA_FINAL} 
		--AND SD2.D2_EMISSAO > '20220828' AND D2_EMISSAO < '20220910'
		
			AND AY0.D_E_L_E_T_ = ' '
	GROUP BY SUBSTRING( D2_EMISSAO , 5, 2), SUBSTRING( D2_EMISSAO , 1, 4) ,SM0.FILFULL ,SM0.FILIAL, AY0.AY0_CODIGO,
	 AY0.AY0_DESC

) AS CNT



select COUNT(*) FROM (
select  CAST(SUBSTRING( D2_EMISSAO , 5, 2) as INTEGER) as MES, SUBSTRING( D2_EMISSAO , 1, 4) AS ANO ,SM0.FILFULL AS COD_FIL,SM0.FILIAL AS DESC_FIL, 
CAST(AY0.AY0_CODIGO as FLOAT) AS COD_CAT,
AY0.AY0_DESC AS DESC_CAT, SUM(D2_QUANT) AS QUANTIDADE,AVG(D2_PRCVEN) as Preco_Unitario , SUM(CV3_VLR01) as Valor_total
FROM CT2010 CT2

INNER JOIN CV3010 CV3 ON CT2_LP = CV3_LP AND CT2.CT2_SEQUEN =CV3.CV3_SEQUEN AND CV3.CV3_DEBITO = CT2_DEBITO AND CV3_CREDIT=CT2_CREDIT
INNER JOIN SD2010 SD2 ON CV3.CV3_RECORI = SD2.R_E_C_N_O_
INNER JOIN SB1010 SB1 ON B1_COD = D2_COD
INNER JOIN SM0010 SM0 ON D2_FILIAL = SM0.FILFULL
LEFT JOIN AY0010 AY0 ON SB1.B1_01CAT5 =AY0.AY0_CODIGO AND AY0.D_E_L_E_T_ = ' '
WHERE CT2.D_E_L_E_T_ = ' ' AND CV3.D_E_L_E_T_ = ' ' AND SD2.D_E_L_E_T_ = ' ' AND SB1.D_E_L_E_T_ = ' ' 
--AND CT2_DATA BETWEEN '20220101' AND '20220131' and CT2_FILIAL='010102'
AND CT2_DATA >=  ${DATA_INICIAL} 
		AND CT2_DATA <=  ${DATA_FINAL} 
AND CT2_CREDIT='410100300001001'

GROUP BY SUBSTRING( D2_EMISSAO , 5, 2), SUBSTRING( D2_EMISSAO , 1, 4) ,SM0.FILFULL ,SM0.FILIAL, AY0.AY0_CODIGO, AY0.AY0_DESC
) as cnt

