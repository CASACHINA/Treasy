
select SM0.FILFULL,SM0.FILIAL, AY0.AY0_CODIGO, AY0.AY0_DESC ,
(
	
	SELECT SUM(D2_QUANT) FROM SD2010 SD2
	INNER JOIN SB1010 SB1 ON B1_COD = D2_COD

	INNER JOIN SF4010 SF4 ON D2_TES = F4_CODIGO AND F4_CODIGO IN( '502',
'503',
'504',
'507',
'508',
'519',
'602',
'603',
'605',
'606',
'607',
'608',
'610',
'611',
'683',
'684',
'685',
'687',
'688',
'691',
'700')
	WHERE SB1.B1_01CAT5 =AY0.AY0_CODIGO 
	
	AND D2_EMISSAO >=  ${DATA_INICIAL} 
	AND D2_EMISSAO <=  ${DATA_FINAL} 
	--AND  SD2.D2_EMISSAO > '20220901' AND D2_EMISSAO < '20220910'
	AND SB1.D_E_L_E_T_ = ' ' AND SD2.D_E_L_E_T_ = ' '
) AS Quantidade_Vendida,

(
	
	SELECT AVG(D2_PRCVEN) FROM SD2010 SD2
	INNER JOIN SB1010 SB1 ON B1_COD = D2_COD
	INNER JOIN SF4010 SF4 ON D2_TES = F4_CODIGO AND F4_CODIGO IN( '502',
'503',
'504',
'507',
'508',
'519',
'602',
'603',
'605',
'606',
'607',
'608',
'610',
'611',
'683',
'684',
'685',
'687',
'688',
'691',
'700')
	WHERE SB1.B1_01CAT5 =AY0.AY0_CODIGO 
	
	AND D2_EMISSAO >=  ${DATA_INICIAL} 
	AND D2_EMISSAO <=  ${DATA_FINAL} 
	--AND  SD2.D2_EMISSAO > '20220901' AND D2_EMISSAO < '20220910'
	AND SB1.D_E_L_E_T_ = ' ' AND SD2.D_E_L_E_T_ = ' '
) AS Preco_Unitario

FROM SM0010 SM0
INNER JOIN AY0010 AY0 ON 1=1

WHERE AY0.D_E_L_E_T_ = ' '

ORDER BY SM0.FILFULL, AY0_CODIGO




